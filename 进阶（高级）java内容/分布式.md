### 分布式理论
任何一个分布式系统都必须满足CAP理论中的两个  
#### CAP原则
C（consistency）：一致性原则，各个分区之间的数据是否一致
A（Availability）：可用性原则，这个分布式系统是否可用
P（Partition tolerance）：分区容忍性，即使出现单个组件无法可用,操作依然可以完成
任何一个分布式系统都必须满足分区容忍性，而一致性和可用性又无法同时达到，所以往往需要在一致性和可用性之间做出抉择

### 分布式事务
#### 两阶段提交（2PC）
核心思想与数据库的2PC一致
将提交分为两个阶段：  
第一阶段：预提交，向事务协调器提交事务，并返回是否可提交
第二阶段：事务协调器提交事务
优点：尽量保证了数据的一致性
缺点：实质是用数据可用性换取数据一致性，不适用于高并发的场景

#### 补偿事务（TCC）
核心思想：针对每一个操作都注册一个确认和补偿（撤销）的操作
分为三个阶段：  
try阶段是业务系统做检测和资源预留
confirm阶段就是业务提交，try成功之后就会执行提交
cancel阶段就是当业务提交出错的话，进行回滚操作，释放预留资源

#### 本地消息表（异步确保）
核心思想：将分布式事务拆分为本地事务处理
消息的生产方额外建立一张消息表用于记录消息发送的状态，消息表和业务数据需要在一个事务里面提交
生产方和消费方定时扫描本地消息表，把还没处理完成的消息或者失败的消息再发送一遍。如果有靠谱的自动对账补账逻辑，这种方案还是非常实用的。

#### MQ事务消息
RocketMQ

#### Sagas 事务模型
该模型其核心思想就是拆分分布式系统中的长事务为多个短事务，或者叫多个本地事务，然后由 Sagas 工作流引擎负责协调，如果整个流程正常结束，那么就算是业务成功完成，如果在这过程中实现失败，那么Sagas工作流引擎就会以相反的顺序调用补偿操作，重新进行业务回滚。
